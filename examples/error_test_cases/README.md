# HPL 错误测试用例集

本目录包含一系列故意包含语法错误的 HPL 脚本，用于测试 HPL 解释器错误位置定位的精准度。

## 文件说明

### 1. `yaml_syntax_errors.hpl`
测试 YAML 解析错误的定位精准度。

| 错误编号 | 行号 | 错误类型 | 描述 |
|---------|------|---------|------|
| 1 | 7 | 无效 YAML 键值对 | `invalid_yaml_key: : : :` |
| 2 | 10-12 | 缩进不一致 | 方法缩进使用 3 个空格而非 2 个 |
| 3 | 15-17 | 列表格式错误 | 空列表项 |
| 4 | 20 | 未闭合字符串 | 字符串缺少右引号 |
| 5 | 23-25 | 重复键 | 相同的键定义两次 |
| 6 | 28 | 无效 YAML 标签 | 使用了无效的标签语法 |
| 7 | 31-34 | 制表符和空格混用 | 同一层级使用不同缩进字符 |
| 8 | 37-40 | 未闭合 YAML 块 | 块标量未正确闭合 |

### 2. `hpl_syntax_errors.hpl`
测试 HPL 核心语法错误的定位精准度。

| 错误编号 | 行号 | 错误类型 | 描述 |
|---------|------|---------|------|
| 1 | 7 | 箭头函数语法错误 | 箭头 `=>` 中间有空格 |
| 2 | 12 | 括号不匹配 | 参数列表缺少右括号 |
| 3 | 17 | 花括号不匹配 | 函数体缺少闭合花括号 |
| 4 | 22 | 无效参数列表 | 参数缺少逗号分隔 |
| 5 | 27 | 缺少箭头 | 函数定义缺少 `=>` |
| 6 | 32 | 无效标识符 | 函数名以数字开头 |
| 7 | 37-42 | 嵌套花括号不匹配 | 多层嵌套缺少闭合 |
| 8 | 45 | 无效字符 | 代码中包含非法字符 |
| 9 | 50 | 字符串引号不匹配 | 字符串未闭合 |
| 10 | 55 | 缺少函数体 | 箭头函数后无代码块 |
| 11 | 58 | 无效 return 语句 | return 缺少返回值 |
| 12 | 63 | 双重箭头 | 使用了 `=> =>` |

### 3. `class_syntax_errors.hpl`
测试类定义和方法定义错误的定位精准度。

| 错误编号 | 行号 | 错误类型 | 描述 |
|---------|------|---------|------|
| 1 | 7 | 缺少父类名 | `parent:` 后无类名 |
| 2 | 14 | 无效构造函数 | 构造函数使用字典而非箭头函数 |
| 3 | 21 | 无效方法名 | 方法名以数字开头 |
| 4 | 28 | 缺少 this 关键字 | 方法调用未使用 `this.` |
| 5 | 37 | 无效继承 | 继承不存在的类 |
| 6 | 44-50 | 重复类名 | 相同的类名定义两次 |
| 7 | 53 | 类中顶层代码 | 类中定义了顶层变量 |
| 8 | 61 | 无效方法参数 | 参数列表有多余逗号 |
| 9 | 67 | 构造函数返回值 | 构造函数中使用了 return |
| 10 | 74 | 嵌套类定义 | 类中嵌套定义另一个类 |
| 11 | 85 | 无效对象实例化 | 实例化不存在的类 |
| 12 | 88 | 缺少构造函数参数 | 未提供必需的构造参数 |

### 4. `control_flow_errors.hpl`
测试控制流语句错误的定位精准度。

| 错误编号 | 行号 | 错误类型 | 描述 |
|---------|------|---------|------|
| 1 | 7 | if 缺少条件 | `if ()` 条件为空 |
| 2 | 11 | if 缺少冒号 | 条件后无冒号 |
| 3 | 15-19 | elif 位置错误 | elif 在 else 之后 |
| 4 | 23 | for 缺少迭代对象 | `for (i in)` 为空 |
| 5 | 27 | for 缺少括号 | 未使用括号包围 |
| 6 | 31 | while 缺少条件 | `while ()` 条件为空 |
| 7 | 35 | while 缺少冒号 | 条件后无冒号 |
| 8 | 39 | try 缺少 catch | 无 catch 块 |
| 9 | 45 | catch 缺少参数 | catch 后无错误变量 |
| 10 | 50-54 | try-catch 顺序错误 | catch 在 try 之前 |
| 11 | 58 | break 位置错误 | break 在循环外 |
| 12 | 61 | continue 位置错误 | continue 在循环外 |
| 13 | 65-72 | 嵌套缩进错误 | 嵌套控制流缩进不一致 |
| 14 | 76-80 | 作用域错误 | 在不可见的作用域引用变量 |
| 15 | 83 | throw 位置错误 | throw 在 try 块外 |

### 5. `expression_errors.hpl`
测试表达式、运算符和函数调用错误的定位精准度。

| 错误编号 | 行号 | 错误类型 | 描述 |
|---------|------|---------|------|
| 1 | 7 | 未闭合括号 | 表达式缺少右括号 |
| 2 | 10 | 运算符连续使用 | `10 ++ 20` 无效 |
| 3 | 13 | 缺少操作数 | 运算符后无操作数 |
| 4 | 16 | 无效赋值 | 给字面量赋值 |
| 5 | 19 | 函数调用未闭合 | 缺少右括号 |
| 6 | 22 | 参数分隔错误 | 参数缺少逗号 |
| 7 | 25 | 数组尾随逗号 | 数组末尾有多余逗号 |
| 8 | 28 | 数组索引未闭合 | 缺少右方括号 |
| 9 | 31 | 字典键错误 | 键未使用引号 |
| 10 | 34 | 字典语法错误 | 缺少冒号 |
| 11 | 37 | 字符串拼接错误 | 运算符后无操作数 |
| 12 | 40 | 无效运算符组合 | `*/` 无效 |
| 13 | 43 | 一元运算符错误 | 前缀自增不支持 |
| 14 | 46 | 链式比较 | 可能不支持链式比较 |
| 15 | 49 | 三元运算符 | HPL 不支持三元运算符 |
| 16 | 52 | 无效变量名 | 使用 `$` 字符 |
| 17 | 55 | 双点号错误 | `..` 无效 |
| 18 | 58 | 缺少对象 | 点号前无对象 |
| 19 | 61 | 嵌套括号不匹配 | 多层括号未闭合 |
| 20 | 64 | 逗号表达式 | 可能不支持逗号表达式 |

### 6. `import_include_errors.hpl`
测试导入和包含语句错误的定位精准度。

| 错误编号 | 行号 | 错误类型 | 描述 |
|---------|------|---------|------|
| 1 | 7 | imports 格式错误 | 缺少列表标记 `-` |
| 2 | 11 | includes 格式错误 | 使用了引号 |
| 3 | 15 | 别名格式错误 | 使用 `as` 而非 `:` |
| 4 | 19 | 空 imports | 空模块名 |
| 5 | 23 | 空 includes | 空文件名 |
| 6 | 27-29 | 重复导入 | 同一模块导入两次 |
| 7 | 33 | 无效模块名 | 以数字开头 |
| 8 | 37 | 嵌套 imports | imports 在类内部 |
| 9 | 46 | 嵌套 includes | includes 在函数内部 |
| 10 | 53 | 混用导入 | imports 和 includes 格式混用 |
| 11 | 59 | 双重冒号 | 别名格式错误 |
| 12 | 63 | 循环包含 | 文件包含自身 |
| 13 | 67 | 路径格式错误 | 路径含空格未引号 |
| 14 | 71-73 | 别名冲突 | 两个模块使用相同别名 |
| 15 | 78 | 动态导入 | 运行时动态导入 |

### 7. `combined_errors.hpl`
综合错误测试文件，包含多种类型的错误组合。

包含的错误类型：
- YAML 结构错误（缩进、重复键）
- 类定义错误（缺少父类名、无效方法名）
- 控制流错误（if/for/while/try-catch 语法错误）
- 表达式错误（括号不匹配、运算符错误）
- 变量和作用域错误（未定义变量、无效变量名）
- 类型错误（字符串算术运算、无效类型转换）
- 对象和方法调用错误（调用不存在的方法）
- 模块使用错误（使用未导入的模块）

## 使用方法

### 测试单个文件
```bash
python -m hpl_runtime error_test_cases/yaml_syntax_errors.hpl
```

### 使用调试模式
```bash
python -m hpl_runtime --debug error_test_cases/hpl_syntax_errors.hpl
```

### 批量测试所有文件
```bash
for file in error_test_cases/*.hpl; do
    echo "Testing: $file"
    python -m hpl_runtime "$file" 2>&1 | head -20
    echo "---"
done
```

## 预期结果

每个测试文件都应该：
1. 在解析或执行阶段产生错误
2. 错误信息应包含准确的行号
3. 错误信息应显示源代码上下文
4. 错误位置指示器应指向正确的列

## 注意事项

1. 这些文件故意包含错误，不应成功执行
2. 某些错误可能在解析阶段就被捕获，有些可能在运行时捕获
3. 错误信息的格式和详细程度可能因 HPL 版本而异
4. 建议结合 `hpl_runtime/utils/error_handler.py` 和 `hpl_runtime/utils/exceptions.py` 来理解错误处理机制
